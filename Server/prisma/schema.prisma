generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DB_URL")
}

enum UserRole {
  USER
  ADMIN
  SUPER_ADMIN
}

enum UserStatus {
  ACTIVE
  BLOCKED
  DELETED
}

enum PostStatus {
  PENDING
  APPROVED
  REJECTED
}

model User {
  id                String      @id @default(cuid())
  name              String
  email             String      @unique
  password          String
  phone             String?     @unique
  address           String?
  profilePhoto      String?
  role              UserRole    @default(USER)
  status            UserStatus  @default(ACTIVE)
  isVerified        Boolean     @default(false)
  otp               String?
  needPasswordChange Boolean    @default(true)
  passwordChangedAt DateTime?
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt

  // Relations
  posts             Post[]
  postVotes         PostVote[]
  comments          Comment[]
  commentVotes      CommentVote[]
  followers         Follow[]    @relation("UserFollowers")
  following         Follow[]    @relation("UserFollowing")

  @@map("users")
}

model Post {
  id           String     @id @default(cuid())
  title        String
  description  String
  image        String
  location     String
  district     String
  division     String
  postDate     DateTime   @default(now())
  crimeDate    DateTime
  status       PostStatus @default(PENDING)
  isDeleted    Boolean    @default(false)
  authorId     String
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  // Relations
  author       User         @relation(fields: [authorId], references: [id], onDelete: Cascade)
  votes        PostVote[]
  comments     Comment[]

  @@map("posts")
}

model PostVote {
  id     String    @id @default(cuid())
  userId String
  postId String
  type   VoteType
  createdAt DateTime @default(now())

  // Relations
  user   User @relation(fields: [userId], references: [id], onDelete: Cascade)
  post   Post @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@unique([userId, postId])
  @@map("post_votes")
}

model Comment {
  id        String   @id @default(cuid())
  content   String
  image     String?
  postId    String
  authorId  String
  isDeleted Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  post     Post          @relation(fields: [postId], references: [id], onDelete: Cascade)
  author   User          @relation(fields: [authorId], references: [id], onDelete: Cascade)
  votes    CommentVote[]

  @@map("comments")
}

model CommentVote {
  id        String   @id @default(cuid())
  userId    String
  commentId String
  type      VoteType
  createdAt DateTime @default(now())

  // Relations
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  comment Comment @relation(fields: [commentId], references: [id], onDelete: Cascade)

  @@unique([userId, commentId])
  @@map("comment_votes")
}

model Follow {
  id          String   @id @default(cuid())
  followerId  String
  followingId String
  createdAt   DateTime @default(now())

  // Relations
  follower  User @relation("UserFollowers", fields: [followerId], references: [id], onDelete: Cascade)
  following User @relation("UserFollowing", fields: [followingId], references: [id], onDelete: Cascade)

  @@unique([followerId, followingId])
  @@map("follows")
}

enum VoteType {
  UP
  DOWN
}